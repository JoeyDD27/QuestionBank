# Phase 1 归档记录 (2026-01-19)

> 阶段1：基础提取 - 从 Word 文档图片提取数学题目内容

## 章节进度

共 33 章，2609 items 全部完成。

| 章节 | Items | 章节 | Items | 章节 | Items |
|------|-------|------|-------|------|-------|
| ch01 | 203 | ch12 | 29 | ch23 | 120 |
| ch02 | 41 | ch13 | 139 | ch24 | 19 |
| ch03 | 41 | ch14 | 160 | ch25 | 98 |
| ch04 | 16 | ch15 | 191 | ch26 | 51 |
| ch05 | 133 | ch16 | 95 | ch27 | 39 |
| ch06 | 98 | ch17 | 10 | ch28 | 47 |
| ch07 | 128 | ch18 | 67 | ch29 | 57 |
| ch08 | 55 | ch19 | 45 | ch30 | 55 |
| ch09 | 34 | ch20 | 27 | ch31 | 41 |
| ch10 | 89 | ch21 | 116 | ch32 | 98 |
| ch11 | 188 | ch22 | 39 | ch33 | 40 |

## 数据库统计

- **chapters**: 33 行
- **images**: 2952 行
- **items**: 2609 行

## 踩坑记录

| 问题 | 描述 | 解决方案 |
|------|------|----------|
| images.order_index | 导入脚本需要此字段排序图片 | 添加该列 |
| API 100 图片限制 | 每个 session 累计读取图片不能超过 100 张 | 使用 Task 子 agent 分批处理 |
| Supabase 1000 row limit | 超过 1000 行的表统计不完整 | 使用 `range()` 分页获取 |
| source_images 错位 | 批量读取图片后编号对应错误 | 强制逐张处理，立即记录 |
| `\texteuro` 不渲染 | KaTeX 不支持 | 直接用 `€` 符号 |
| markdown 斜体污染 | `*text*` 格式会原样显示 | 不用 markdown 斜体 |
| `$` 符号冲突 | LaTeX 和货币符号冲突 | 改用 `｢...｣` 作为数学分隔符 |
| `\$` 转义符号 | 货币 `\$` 与数学 `$` 配对错误 | 先替换 `\$` 为占位符再处理 |

## Skill 优化历程

`questionbank-chapter-processor` skill 多次优化：

1. **Task 子 agent 自动分批** - 每个子 agent 独立 context，图片计数不累积
2. **平均分配优化** - 改用平均分配代替固定 80 张/批，最多 4 个并行 agent
3. **自动批次计算** - 支持 "从 chN 开始一批" 命令，自动累加图片数
4. **修复 source_images 错位** - 强调逐张处理，每读一张立即记录
